<!DOCTYPE html >
<meta charset="utf-8">
<head>
	<title>WISEBED REST/WebSocket API v2.3 - Login</title>
	<link rel="stylesheet" media="screen" href="bootstrap.css">
	<style type="text/css">
		.container {
			padding-top: 20px;
		}
	</style>
	<script type="text/javascript" src="jquery-1.7.1.js"></script>
	<script type="text/javascript">

		var loginFormRows = new Array();

		function removeRowFromLoginForm() {

			if (loginFormRows.length > 1) {
				loginFormRows[loginFormRows.length-1].tr.remove();
				loginFormRows.splice(loginFormRows.length-1, 1);
			}
		}

		function addRowToLoginForm() {

			var tr = $('<tr/>');

			var i = loginFormRows.length;

			var inputUrnPrefix = $('<input type="text" id="urnprefix'+i+'" name="urnprefix'+i+'"/>');
			var inputUsername = $('<input type="text" id="username'+i+'" name="username'+i+'"/>');
			var inputPassword = $('<input type="password" id="password'+i+'" name="password'+i+'"/>');

			loginFormRows[loginFormRows.length] = {
				"tr" : tr,
				"inputUrnPrefix" : inputUrnPrefix[0],
				"inputUsername" : inputUsername[0],
				"inputPassword" : inputPassword[0]
			};

			var tdUrnPrefix = $('<td/>');
			var tdUsername = $('<td/>');
			var tdPassword = $('<td/>');

			tdUrnPrefix.append(inputUrnPrefix);
			tdUsername.append(inputUsername);
			tdPassword.append(inputPassword);

			tr.append($('<td>'+(loginFormRows.length)+'</td>'));
			tr.append(tdUrnPrefix);
			tr.append(tdUsername);
			tr.append(tdPassword);
			tr.append($('<td>&nbsp;</td>'));

			$('#credentialsTable').append(tr);
		}

		function readLoginDataFromForm() {

			loginData = new Object();
			loginData.authenticationData = new Array();

			for (var i=0; i<loginFormRows.length; i++) {

				loginData.authenticationData[i] = new Object();
				loginData.authenticationData[i].urnPrefix = loginFormRows[i].inputUrnPrefix.value;
				loginData.authenticationData[i].username = loginFormRows[i].inputUsername.value;
				loginData.authenticationData[i].password = loginFormRows[i].inputPassword.value;
			}

			return loginData;
		}

		function login(event) {
			event.preventDefault();
			var data = readLoginDataFromForm();
			console.log(data);
			$.ajax({
				url         : "/rest/2.3/login",
				type        : "POST",
				data        : JSON.stringify(data, null, '\t'),
				contentType : "application/json; charset=utf-8",
				dataType    : "json",
				success     : function(response){alert(JSON.stringify(response))},
				error       : function(jqXHR, textStatus, errorThrown){alert("Error: " + textStatus)}
			});
		}

		$(document).ready(function () {
			addRowToLoginForm();
			$("#loginForm").submit(login);
		});

	</script>
</head>
<body>

<div class="container">

	<h1>WISEBED REST/WebSocket API v2.3</h1>

	<h2>Login</h2>

	<hr/>

	<form id="loginForm" name="loginForm" action="/rest/2.3/login" method="post">
		<table id="credentialsTable">
			<thead>
				<tr>
					<td>Testbed</td>
					<td>URN Prefix</td>
					<td>Username</td>
					<td>Password</td>
					<td>
						<input type="button" onclick="addRowToLoginForm()" value=" + "/>&nbsp;
						<input type="button" onclick="removeRowFromLoginForm()" value=" - "/>
					</td>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
		<input type="submit" class="span6" value="login" />
	</form>

</div>

</body>
</html>